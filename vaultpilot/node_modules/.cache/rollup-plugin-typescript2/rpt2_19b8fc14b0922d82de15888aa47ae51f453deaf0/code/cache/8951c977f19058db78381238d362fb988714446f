{"code":"import { __awaiter } from \"tslib\";\nimport { Modal, Notice } from 'obsidian';\nimport { getActiveMarkdown } from './vault-utils';\nimport { DevelopmentContextService } from './services/DevelopmentContextService';\nexport class ChatModal extends Modal {\n    constructor(app, plugin) {\n        super(app);\n        this.currentConversationId = null;\n        this.messages = [];\n        this.plugin = plugin;\n        this.contextService = new DevelopmentContextService(app, plugin);\n    }\n    onOpen() {\n        const { contentEl } = this;\n        contentEl.empty();\n        contentEl.addClass('vaultpilot-chat-modal');\n        // Modal header\n        const headerEl = contentEl.createEl('div', { cls: 'vaultpilot-chat-header' });\n        headerEl.createEl('h2', { text: 'ü§ñ VaultPilot Chat' });\n        const toolbarEl = headerEl.createEl('div', { cls: 'vaultpilot-chat-toolbar' });\n        // Add info about automatic mode detection\n        const autoModeInfo = toolbarEl.createEl('div', {\n            cls: 'vaultpilot-auto-mode-info',\n            text: '‚ö° Automatic mode detection enabled'\n        });\n        // Add context indicator\n        const contextInfo = toolbarEl.createEl('div', {\n            cls: 'vaultpilot-context-info',\n            text: 'üß† Smart context enabled'\n        });\n        // Clear chat button\n        const clearBtn = toolbarEl.createEl('button', {\n            text: 'Clear Chat',\n            cls: 'mod-cta'\n        });\n        clearBtn.onclick = () => this.clearChat();\n        // Agent selector (will be populated when agents are loaded)\n        const agentSelect = toolbarEl.createEl('select', { cls: 'vaultpilot-agent-select' });\n        agentSelect.createEl('option', { text: 'Auto-select Agent', value: '' });\n        this.loadAgents(agentSelect);\n        // Chat container\n        this.chatContainer = contentEl.createEl('div', { cls: 'vaultpilot-chat-container' });\n        // Messages area\n        this.messagesEl = this.chatContainer.createEl('div', { cls: 'vaultpilot-chat-messages' });\n        // Input container\n        this.inputContainer = this.chatContainer.createEl('div', { cls: 'vaultpilot-chat-input-container' });\n        this.inputEl = this.inputContainer.createEl('input', {\n            type: 'text',\n            placeholder: 'Ask a question or describe what you want to accomplish...',\n            cls: 'vaultpilot-chat-input'\n        });\n        this.sendButton = this.inputContainer.createEl('button', {\n            text: 'Send',\n            cls: 'mod-cta vaultpilot-send-button'\n        });\n        // Event listeners\n        this.inputEl.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                this.sendMessage();\n            }\n        });\n        this.sendButton.onclick = () => this.sendMessage();\n        // Focus the input\n        this.inputEl.focus();\n        // Load conversation history\n        this.loadConversationHistory();\n        // Add styles\n        this.addStyles();\n    }\n    loadAgents(selectEl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                console.log('VaultPilot: Loading agents...');\n                const response = yield this.plugin.apiClient.getAgents();\n                console.log('VaultPilot: getAgents response:', response);\n                if (response.success && response.data) {\n                    console.log('VaultPilot: response.data type:', typeof response.data);\n                    console.log('VaultPilot: response.data content:', response.data);\n                    let agents = [];\n                    // Check if data is directly an array\n                    if (Array.isArray(response.data)) {\n                        agents = response.data;\n                    }\n                    // Check if data has an 'agents' property with an array\n                    else if (response.data && typeof response.data === 'object') {\n                        const dataObj = response.data;\n                        if (dataObj.agents && Array.isArray(dataObj.agents)) {\n                            agents = dataObj.agents;\n                        }\n                        else if (dataObj.data && Array.isArray(dataObj.data)) {\n                            agents = dataObj.data;\n                        }\n                    }\n                    if (agents.length > 0) {\n                        console.log('VaultPilot: Found', agents.length, 'agents');\n                        agents.forEach(agent => {\n                            const option = selectEl.createEl('option', {\n                                text: agent.name,\n                                value: agent.id\n                            });\n                        });\n                    }\n                    else {\n                        console.log('VaultPilot: No agents found in response');\n                        // Add a default option indicating no agents\n                        const option = selectEl.createEl('option', {\n                            text: 'No agents available',\n                            value: ''\n                        });\n                        option.disabled = true;\n                    }\n                }\n                else {\n                    console.error('Failed to load agents: API returned error or no data:', response);\n                }\n            }\n            catch (error) {\n                console.error('Failed to load agents:', error);\n            }\n        });\n    }\n    loadConversationHistory() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // Only try to load conversation history if we have a conversation ID\n            if (this.currentConversationId) {\n                try {\n                    const response = yield this.plugin.apiClient.getConversationHistory(this.currentConversationId);\n                    if (response.success && response.data) {\n                        this.messages = response.data.messages;\n                        this.renderMessages();\n                    }\n                }\n                catch (error) {\n                    console.error('Failed to load conversation history:', error);\n                }\n            }\n            // If no conversation ID, start fresh (no history to load)\n        });\n    }\n    sendMessage() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const message = this.inputEl.value.trim();\n            if (!message)\n                return;\n            // Disable input while processing\n            this.inputEl.disabled = true;\n            this.sendButton.disabled = true;\n            this.sendButton.textContent = 'Sending...';\n            // Add user message to UI\n            this.addMessage('user', message);\n            this.inputEl.value = '';\n            try {\n                // ‚îÄ‚îÄ fetch context & intent in parallel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n                const [markdownContext, intentRes, devContext] = yield Promise.all([\n                    getActiveMarkdown(), // returns string | null\n                    this.plugin.apiClient.classifyIntent(message), // POST /intelligence/parse\n                    this.contextService.getFullContext() // Get comprehensive development context\n                ]);\n                // Build context summary including both markdown and development context\n                const contextSummary = yield this.contextService.getContextSummary();\n                // Combine contexts for enhanced AI understanding\n                let fullContext = '';\n                if (markdownContext) {\n                    fullContext += `## Active File Content\\n${markdownContext}\\n\\n`;\n                }\n                fullContext += contextSummary;\n                // build a generic payload with enhanced context\n                const payload = {\n                    message,\n                    context: fullContext,\n                    development_context: devContext // Add structured context for advanced processing\n                };\n                // Show intent detection in UI if debug mode is enabled\n                if (this.plugin.settings.showIntentDebug) {\n                    this.showIntentDebug(intentRes.intent);\n                }\n                let response;\n                if (intentRes.intent === \"agent\") {\n                    response = yield this.plugin.apiClient.runWorkflow(payload); // POST /workflow\n                    if (response.success && response.data) {\n                        this.addMessage('assistant', `‚öôÔ∏è Agent Mode (auto-detected)\\n\\n${response.data.result}`);\n                    }\n                    else {\n                        this.addMessage('assistant', `Error in agent mode: ${response.error || 'Failed to get response'}`);\n                    }\n                    if (!response.success) {\n                        new Notice(`Chat error: ${response.error}`);\n                    }\n                }\n                else {\n                    // Use streaming for chat responses\n                    yield this.handleStreamingResponse(payload);\n                }\n                // Show context info to user\n                if (fullContext.length > 0) {\n                    let contextInfo = `üìä Context included: ${devContext.project.type} project, ${devContext.workspace.totalFiles} files`;\n                    if (devContext.activeFile) {\n                        contextInfo += `, active file: ${devContext.activeFile.name}`;\n                    }\n                    new Notice(contextInfo, 3000);\n                }\n                else {\n                    new Notice(\"‚ö†Ô∏è No vault content was sent; replies may be generic.\");\n                }\n            }\n            catch (error) {\n                const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n                this.addMessage('assistant', `Error: ${errorMsg}`);\n                new Notice(`Chat error: ${errorMsg}`);\n            }\n            finally {\n                // Re-enable input\n                this.inputEl.disabled = false;\n                this.sendButton.disabled = false;\n                this.sendButton.textContent = 'Send';\n                this.inputEl.focus();\n            }\n        });\n    }\n    handleStreamingResponse(payload) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                // Create a streaming message placeholder\n                const streamingMessageEl = this.addStreamingMessage('assistant');\n                // Start the stream\n                const stream = yield this.plugin.apiClient.streamChat({\n                    message: payload.message,\n                    context: payload.context,\n                    conversation_id: this.currentConversationId || undefined,\n                    agent_id: this.getSelectedAgent(),\n                    development_context: payload.development_context\n                });\n                yield this.processStreamingResponse(stream, streamingMessageEl);\n            }\n            catch (error) {\n                const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n                this.addMessage('assistant', `Error: ${errorMsg}`);\n                new Notice(`Streaming error: ${errorMsg}`);\n            }\n        });\n    }\n    addStreamingMessage(role) {\n        const messageEl = this.messagesEl.createEl('div', {\n            cls: `vaultpilot-message vaultpilot-message-${role} vaultpilot-message-streaming`\n        });\n        const roleEl = messageEl.createEl('div', {\n            cls: 'vaultpilot-message-role',\n            text: role === 'user' ? 'You' : 'VaultPilot'\n        });\n        const contentEl = messageEl.createEl('div', {\n            cls: 'vaultpilot-message-content'\n        });\n        // Add typing indicator\n        const typingEl = contentEl.createEl('div', {\n            cls: 'vaultpilot-typing-indicator',\n            text: 'typing...'\n        });\n        const timeEl = messageEl.createEl('div', {\n            cls: 'vaultpilot-message-time',\n            text: new Date().toLocaleTimeString()\n        });\n        this.scrollToBottom();\n        return messageEl;\n    }\n    processStreamingResponse(stream, messageEl) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const reader = stream.getReader();\n            const decoder = new TextDecoder();\n            const contentEl = messageEl.querySelector('.vaultpilot-message-content');\n            // Remove typing indicator\n            const typingEl = contentEl.querySelector('.vaultpilot-typing-indicator');\n            if (typingEl) {\n                typingEl.remove();\n            }\n            let accumulatedContent = '';\n            try {\n                while (true) {\n                    const { done, value } = yield reader.read();\n                    if (done) {\n                        break;\n                    }\n                    const chunk = decoder.decode(value, { stream: true });\n                    const lines = chunk.split('\\n');\n                    for (const line of lines) {\n                        if (line.startsWith('data: ')) {\n                            try {\n                                const data = JSON.parse(line.substring(6));\n                                if (data.type === 'chunk' && data.content) {\n                                    accumulatedContent += data.content;\n                                    contentEl.innerHTML = this.renderMarkdown(accumulatedContent);\n                                    this.scrollToBottom();\n                                }\n                                else if (data.type === 'complete') {\n                                    // Update conversation ID if provided\n                                    if (data.conversation_id) {\n                                        this.currentConversationId = data.conversation_id;\n                                    }\n                                    // Mark message as complete\n                                    messageEl.removeClass('vaultpilot-message-streaming');\n                                    break;\n                                }\n                                else if (data.type === 'error') {\n                                    accumulatedContent += `\\n\\nError: ${data.error}`;\n                                    contentEl.innerHTML = this.renderMarkdown(accumulatedContent);\n                                    messageEl.removeClass('vaultpilot-message-streaming');\n                                    break;\n                                }\n                            }\n                            catch (parseError) {\n                                console.warn('Failed to parse streaming chunk:', parseError);\n                            }\n                        }\n                    }\n                }\n                // Add to messages array\n                const message = {\n                    role: 'assistant',\n                    content: accumulatedContent,\n                    timestamp: new Date().toISOString()\n                };\n                this.messages.push(message);\n            }\n            catch (error) {\n                console.error('Streaming error:', error);\n                contentEl.innerHTML = this.renderMarkdown(`Error during streaming: ${error instanceof Error ? error.message : 'Unknown error'}`);\n            }\n            finally {\n                reader.releaseLock();\n                messageEl.removeClass('vaultpilot-message-streaming');\n            }\n        });\n    }\n    getSelectedAgent() {\n        const selectEl = this.contentEl.querySelector('.vaultpilot-agent-select');\n        return (selectEl === null || selectEl === void 0 ? void 0 : selectEl.value) || undefined;\n    }\n    addMessage(role, content) {\n        const message = {\n            role,\n            content,\n            timestamp: new Date().toISOString()\n        };\n        this.messages.push(message);\n        this.renderMessage(message);\n        this.scrollToBottom();\n    }\n    renderMessages() {\n        this.messagesEl.empty();\n        this.messages.forEach(message => this.renderMessage(message));\n        this.scrollToBottom();\n    }\n    renderMessage(message) {\n        const messageEl = this.messagesEl.createEl('div', {\n            cls: `vaultpilot-message vaultpilot-message-${message.role}`\n        });\n        const roleEl = messageEl.createEl('div', {\n            cls: 'vaultpilot-message-role',\n            text: message.role === 'user' ? 'You' : 'VaultPilot'\n        });\n        const contentEl = messageEl.createEl('div', {\n            cls: 'vaultpilot-message-content'\n        });\n        // Simple markdown rendering for basic formatting\n        contentEl.innerHTML = this.renderMarkdown(message.content);\n        if (message.timestamp) {\n            const timeEl = messageEl.createEl('div', {\n                cls: 'vaultpilot-message-time',\n                text: new Date(message.timestamp).toLocaleTimeString()\n            });\n        }\n    }\n    renderMarkdown(text) {\n        return text\n            .replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>')\n            .replace(/\\*(.*?)\\*/g, '<em>$1</em>')\n            .replace(/`(.*?)`/g, '<code>$1</code>')\n            .replace(/\\n/g, '<br>');\n    }\n    scrollToBottom() {\n        this.messagesEl.scrollTop = this.messagesEl.scrollHeight;\n    }\n    clearChat() {\n        this.messages = [];\n        this.currentConversationId = null;\n        this.messagesEl.empty();\n        new Notice('Chat cleared');\n    }\n    addStyles() {\n        if (!document.getElementById('vaultpilot-chat-styles')) {\n            const styleEl = document.createElement('style');\n            styleEl.id = 'vaultpilot-chat-styles';\n            styleEl.textContent = `\n        .vaultpilot-chat-modal {\n          width: 600px;\n          height: 700px;\n        }\n        .vaultpilot-chat-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 15px;\n          padding-bottom: 10px;\n          border-bottom: 1px solid var(--background-modifier-border);\n        }\n        .vaultpilot-chat-toolbar {\n          display: flex;\n          gap: 10px;\n          align-items: center;\n          flex-wrap: wrap;\n        }\n        .vaultpilot-auto-mode-info {\n          margin-right: 15px;\n          padding: 8px 12px;\n          border: 1px solid var(--background-modifier-border);\n          border-radius: 6px;\n          background: var(--background-secondary);\n          font-size: 0.85em;\n          color: var(--text-muted);\n          display: flex;\n          align-items: center;\n          gap: 6px;\n        }\n        .vaultpilot-agent-select {\n          padding: 4px 8px;\n          border: 1px solid var(--background-modifier-border);\n          border-radius: 4px;\n          background: var(--background-primary);\n          color: var(--text-normal);\n        }\n        .vaultpilot-chat-container {\n          display: flex;\n          flex-direction: column;\n          height: calc(100% - 80px);\n        }\n        .vaultpilot-chat-messages {\n          flex: 1;\n          overflow-y: auto;\n          padding: 10px;\n          border: 1px solid var(--background-modifier-border);\n          border-radius: 8px;\n          margin-bottom: 15px;\n          background: var(--background-secondary);\n        }\n        .vaultpilot-message {\n          margin-bottom: 15px;\n          padding: 10px;\n          border-radius: 8px;\n        }\n        .vaultpilot-message-user {\n          background: var(--background-primary-alt);\n          margin-left: 20px;\n        }\n        .vaultpilot-message-assistant {\n          background: var(--background-primary);\n          margin-right: 20px;\n        }\n        .vaultpilot-message-role {\n          font-weight: bold;\n          margin-bottom: 5px;\n          color: var(--text-accent);\n        }\n        .vaultpilot-message-content {\n          line-height: 1.4;\n          color: var(--text-normal);\n          user-select: text;\n        }\n        .vaultpilot-message-time {\n          font-size: 0.8em;\n          color: var(--text-muted);\n          margin-top: 5px;\n        }\n        .vaultpilot-message-streaming {\n          border-left: 3px solid var(--color-accent);\n          animation: pulse 2s infinite;\n        }\n        .vaultpilot-typing-indicator {\n          color: var(--text-muted);\n          font-style: italic;\n          animation: pulse 1.5s infinite;\n        }\n        @keyframes pulse {\n          0% { opacity: 1; }\n          50% { opacity: 0.5; }\n          100% { opacity: 1; }\n        }\n        .vaultpilot-chat-input-container {\n          display: flex;\n          gap: 10px;\n        }\n        .vaultpilot-chat-input {\n          flex: 1;\n          padding: 10px;\n          border: 1px solid var(--background-modifier-border);\n          border-radius: 6px;\n          background: var(--background-primary);\n          color: var(--text-normal);\n        }\n        .vaultpilot-send-button {\n          padding: 10px 20px;\n        }\n        .vaultpilot-intent-debug {\n          background: var(--background-modifier-success);\n          color: var(--text-normal);\n          padding: 8px 12px;\n          border-radius: 4px;\n          margin: 8px 0;\n          font-size: 0.85em;\n          text-align: center;\n          border: 1px solid var(--background-modifier-border-hover);\n          animation: fadeInOut 3s ease-in-out;\n        }\n        @keyframes fadeInOut {\n          0% { opacity: 0; transform: translateY(-10px); }\n          10% { opacity: 1; transform: translateY(0); }\n          90% { opacity: 1; transform: translateY(0); }\n          100% { opacity: 0; transform: translateY(-10px); }\n        }\n      `;\n            document.head.appendChild(styleEl);\n        }\n    }\n    showIntentDebug(intent) {\n        // Create a subtle notification showing the detected intent\n        const debugEl = this.messagesEl.createEl('div', {\n            cls: 'vaultpilot-intent-debug',\n            text: `üîç Intent detected: ${intent === 'agent' ? '‚öôÔ∏è Agent Mode' : 'üí¨ Ask Mode'}`\n        });\n        // Auto-remove after 3 seconds\n        setTimeout(() => {\n            debugEl.remove();\n        }, 3000);\n    }\n    // Add a method to show context details\n    showContextDetails() {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                const context = yield this.contextService.getFullContext();\n                const summary = yield this.contextService.getContextSummary();\n                // Create a modal or notice with context details\n                const contextModal = new Modal(this.app);\n                contextModal.titleEl.setText('Development Context Details');\n                const { contentEl } = contextModal;\n                contentEl.empty();\n                contentEl.addClass('vaultpilot-context-details');\n                // Add context summary\n                const summaryEl = contentEl.createEl('div', { cls: 'context-summary' });\n                summaryEl.createEl('pre', { text: summary });\n                // Add detailed context (collapsed by default)\n                const detailsEl = contentEl.createEl('details');\n                detailsEl.createEl('summary', { text: 'Full Context Data (JSON)' });\n                const jsonEl = detailsEl.createEl('pre', { cls: 'context-json' });\n                jsonEl.textContent = JSON.stringify(context, null, 2);\n                contextModal.open();\n            }\n            catch (error) {\n                const errorMsg = error instanceof Error ? error.message : 'Unknown error';\n                new Notice(`Error loading context: ${errorMsg}`);\n            }\n        });\n    }\n    onClose() {\n        const { contentEl } = this;\n        contentEl.empty();\n    }\n}\n//# sourceMappingURL=chat-modal.js.map","references":["/Users/malachiledbetter/Documents/GitHub/VaultPilot/vaultpilot/node_modules/obsidian/obsidian.d.ts","/Users/malachiledbetter/Documents/GitHub/VaultPilot/vaultpilot/src/main.ts","/Users/malachiledbetter/Documents/GitHub/VaultPilot/vaultpilot/src/types.ts","/Users/malachiledbetter/Documents/GitHub/VaultPilot/vaultpilot/src/vault-utils.ts","/Users/malachiledbetter/Documents/GitHub/VaultPilot/vaultpilot/src/services/DevelopmentContextService.ts"],"map":"{\"version\":3,\"file\":\"chat-modal.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../src/chat-modal.ts\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"import { Modal, App, Setting, Notice } from 'obsidian';\\nimport type VaultPilotPlugin from './main';\\nimport { ChatMessage, Intent, StreamMessage } from './types';\\nimport { getActiveMarkdown } from './vault-utils';\\nimport { DevelopmentContextService } from './services/DevelopmentContextService';\\n\\nexport class ChatModal extends Modal {\\n  plugin: VaultPilotPlugin;\\n  private chatContainer!: HTMLElement;\\n  private inputContainer!: HTMLElement;\\n  private messagesEl!: HTMLElement;\\n  private inputEl!: HTMLInputElement;\\n  private sendButton!: HTMLButtonElement;\\n  private currentConversationId: string | null = null;\\n  private messages: ChatMessage[] = [];\\n  private contextService: DevelopmentContextService;\\n\\n  constructor(app: App, plugin: VaultPilotPlugin) {\\n    super(app);\\n    this.plugin = plugin;\\n    this.contextService = new DevelopmentContextService(app, plugin);\\n  }\\n\\n  onOpen() {\\n    const { contentEl } = this;\\n    contentEl.empty();\\n    contentEl.addClass('vaultpilot-chat-modal');\\n\\n    // Modal header\\n    const headerEl = contentEl.createEl('div', { cls: 'vaultpilot-chat-header' });\\n    headerEl.createEl('h2', { text: 'ü§ñ VaultPilot Chat' });\\n    \\n    const toolbarEl = headerEl.createEl('div', { cls: 'vaultpilot-chat-toolbar' });\\n    \\n    // Add info about automatic mode detection\\n    const autoModeInfo = toolbarEl.createEl('div', { \\n      cls: 'vaultpilot-auto-mode-info',\\n      text: '‚ö° Automatic mode detection enabled'\\n    });\\n    \\n    // Add context indicator\\n    const contextInfo = toolbarEl.createEl('div', { \\n      cls: 'vaultpilot-context-info',\\n      text: 'üß† Smart context enabled'\\n    });\\n    \\n    // Clear chat button\\n    const clearBtn = toolbarEl.createEl('button', { \\n      text: 'Clear Chat',\\n      cls: 'mod-cta'\\n    });\\n    clearBtn.onclick = () => this.clearChat();\\n\\n    // Agent selector (will be populated when agents are loaded)\\n    const agentSelect = toolbarEl.createEl('select', { cls: 'vaultpilot-agent-select' });\\n    agentSelect.createEl('option', { text: 'Auto-select Agent', value: '' });\\n    this.loadAgents(agentSelect);\\n\\n    // Chat container\\n    this.chatContainer = contentEl.createEl('div', { cls: 'vaultpilot-chat-container' });\\n    \\n    // Messages area\\n    this.messagesEl = this.chatContainer.createEl('div', { cls: 'vaultpilot-chat-messages' });\\n    \\n    // Input container\\n    this.inputContainer = this.chatContainer.createEl('div', { cls: 'vaultpilot-chat-input-container' });\\n    \\n    this.inputEl = this.inputContainer.createEl('input', {\\n      type: 'text',\\n      placeholder: 'Ask a question or describe what you want to accomplish...',\\n      cls: 'vaultpilot-chat-input'\\n    });\\n\\n    this.sendButton = this.inputContainer.createEl('button', {\\n      text: 'Send',\\n      cls: 'mod-cta vaultpilot-send-button'\\n    });\\n\\n    // Event listeners\\n    this.inputEl.addEventListener('keydown', (e) => {\\n      if (e.key === 'Enter' && !e.shiftKey) {\\n        e.preventDefault();\\n        this.sendMessage();\\n      }\\n    });\\n\\n    this.sendButton.onclick = () => this.sendMessage();\\n\\n    // Focus the input\\n    this.inputEl.focus();\\n\\n    // Load conversation history\\n    this.loadConversationHistory();\\n\\n    // Add styles\\n    this.addStyles();\\n  }\\n\\n  private async loadAgents(selectEl: HTMLSelectElement) {\\n    try {\\n      console.log('VaultPilot: Loading agents...');\\n      const response = await this.plugin.apiClient.getAgents();\\n      console.log('VaultPilot: getAgents response:', response);\\n      \\n      if (response.success && response.data) {\\n        console.log('VaultPilot: response.data type:', typeof response.data);\\n        console.log('VaultPilot: response.data content:', response.data);\\n        \\n        let agents: any[] = [];\\n        \\n        // Check if data is directly an array\\n        if (Array.isArray(response.data)) {\\n          agents = response.data;\\n        } \\n        // Check if data has an 'agents' property with an array\\n        else if (response.data && typeof response.data === 'object') {\\n          const dataObj = response.data as any;\\n          if (dataObj.agents && Array.isArray(dataObj.agents)) {\\n            agents = dataObj.agents;\\n          } else if (dataObj.data && Array.isArray(dataObj.data)) {\\n            agents = dataObj.data;\\n          }\\n        }\\n        \\n        if (agents.length > 0) {\\n          console.log('VaultPilot: Found', agents.length, 'agents');\\n          agents.forEach(agent => {\\n            const option = selectEl.createEl('option', {\\n              text: agent.name,\\n              value: agent.id\\n            });\\n          });\\n        } else {\\n          console.log('VaultPilot: No agents found in response');\\n          // Add a default option indicating no agents\\n          const option = selectEl.createEl('option', {\\n            text: 'No agents available',\\n            value: ''\\n          });\\n          option.disabled = true;\\n        }\\n      } else {\\n        console.error('Failed to load agents: API returned error or no data:', response);\\n      }\\n    } catch (error) {\\n      console.error('Failed to load agents:', error);\\n    }\\n  }\\n\\n  private async loadConversationHistory() {\\n    // Only try to load conversation history if we have a conversation ID\\n    if (this.currentConversationId) {\\n      try {\\n        const response = await this.plugin.apiClient.getConversationHistory(this.currentConversationId);\\n        if (response.success && response.data) {\\n          this.messages = response.data.messages;\\n          this.renderMessages();\\n        }\\n      } catch (error) {\\n        console.error('Failed to load conversation history:', error);\\n      }\\n    }\\n    // If no conversation ID, start fresh (no history to load)\\n  }\\n\\n  private async sendMessage() {\\n    const message = this.inputEl.value.trim();\\n    if (!message) return;\\n\\n    // Disable input while processing\\n    this.inputEl.disabled = true;\\n    this.sendButton.disabled = true;\\n    this.sendButton.textContent = 'Sending...';\\n\\n    // Add user message to UI\\n    this.addMessage('user', message);\\n    this.inputEl.value = '';\\n\\n    try {\\n      // ‚îÄ‚îÄ fetch context & intent in parallel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\\n      const [markdownContext, intentRes, devContext] = await Promise.all([\\n        getActiveMarkdown(),          // returns string | null\\n        this.plugin.apiClient.classifyIntent(message),  // POST /intelligence/parse\\n        this.contextService.getFullContext() // Get comprehensive development context\\n      ]);\\n\\n      // Build context summary including both markdown and development context\\n      const contextSummary = await this.contextService.getContextSummary();\\n      \\n      // Combine contexts for enhanced AI understanding\\n      let fullContext = '';\\n      if (markdownContext) {\\n        fullContext += `## Active File Content\\\\n${markdownContext}\\\\n\\\\n`;\\n      }\\n      fullContext += contextSummary;\\n\\n      // build a generic payload with enhanced context\\n      const payload = { \\n        message, \\n        context: fullContext,\\n        development_context: devContext // Add structured context for advanced processing\\n      };\\n\\n      // Show intent detection in UI if debug mode is enabled\\n      if (this.plugin.settings.showIntentDebug) {\\n        this.showIntentDebug(intentRes.intent);\\n      }\\n\\n      let response;\\n      \\n      if (intentRes.intent === \\\"agent\\\") {\\n        response = await this.plugin.apiClient.runWorkflow(payload);     // POST /workflow\\n        \\n        if (response.success && response.data) {\\n          this.addMessage('assistant', `‚öôÔ∏è Agent Mode (auto-detected)\\\\n\\\\n${response.data.result}`);\\n        } else {\\n          this.addMessage('assistant', `Error in agent mode: ${response.error || 'Failed to get response'}`);\\n        }\\n        \\n        if (!response.success) {\\n          new Notice(`Chat error: ${response.error}`);\\n        }\\n      } else {\\n        // Use streaming for chat responses\\n        await this.handleStreamingResponse(payload);\\n      }\\n\\n      // Show context info to user\\n      if (fullContext.length > 0) {\\n        let contextInfo = `üìä Context included: ${devContext.project.type} project, ${devContext.workspace.totalFiles} files`;\\n        if (devContext.activeFile) {\\n          contextInfo += `, active file: ${devContext.activeFile.name}`;\\n        }\\n        new Notice(contextInfo, 3000);\\n      } else {\\n        new Notice(\\\"‚ö†Ô∏è No vault content was sent; replies may be generic.\\\");\\n      }\\n    } catch (error) {\\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\\n      this.addMessage('assistant', `Error: ${errorMsg}`);\\n      new Notice(`Chat error: ${errorMsg}`);\\n    } finally {\\n      // Re-enable input\\n      this.inputEl.disabled = false;\\n      this.sendButton.disabled = false;\\n      this.sendButton.textContent = 'Send';\\n      this.inputEl.focus();\\n    }\\n  }\\n\\n  private async handleStreamingResponse(payload: { message: string; context: string; development_context?: any }) {\\n    try {\\n      // Create a streaming message placeholder\\n      const streamingMessageEl = this.addStreamingMessage('assistant');\\n      \\n      // Start the stream\\n      const stream = await this.plugin.apiClient.streamChat({\\n        message: payload.message,\\n        context: payload.context,\\n        conversation_id: this.currentConversationId || undefined,\\n        agent_id: this.getSelectedAgent(),\\n        development_context: payload.development_context\\n      });\\n\\n      await this.processStreamingResponse(stream, streamingMessageEl);\\n    } catch (error) {\\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\\n      this.addMessage('assistant', `Error: ${errorMsg}`);\\n      new Notice(`Streaming error: ${errorMsg}`);\\n    }\\n  }\\n\\n  private addStreamingMessage(role: 'user' | 'assistant'): HTMLElement {\\n    const messageEl = this.messagesEl.createEl('div', {\\n      cls: `vaultpilot-message vaultpilot-message-${role} vaultpilot-message-streaming`\\n    });\\n\\n    const roleEl = messageEl.createEl('div', {\\n      cls: 'vaultpilot-message-role',\\n      text: role === 'user' ? 'You' : 'VaultPilot'\\n    });\\n\\n    const contentEl = messageEl.createEl('div', {\\n      cls: 'vaultpilot-message-content'\\n    });\\n\\n    // Add typing indicator\\n    const typingEl = contentEl.createEl('div', {\\n      cls: 'vaultpilot-typing-indicator',\\n      text: 'typing...'\\n    });\\n\\n    const timeEl = messageEl.createEl('div', {\\n      cls: 'vaultpilot-message-time',\\n      text: new Date().toLocaleTimeString()\\n    });\\n\\n    this.scrollToBottom();\\n    return messageEl;\\n  }\\n\\n  private async processStreamingResponse(stream: ReadableStream, messageEl: HTMLElement) {\\n    const reader = stream.getReader();\\n    const decoder = new TextDecoder();\\n    const contentEl = messageEl.querySelector('.vaultpilot-message-content') as HTMLElement;\\n    \\n    // Remove typing indicator\\n    const typingEl = contentEl.querySelector('.vaultpilot-typing-indicator');\\n    if (typingEl) {\\n      typingEl.remove();\\n    }\\n\\n    let accumulatedContent = '';\\n    \\n    try {\\n      while (true) {\\n        const { done, value } = await reader.read();\\n        \\n        if (done) {\\n          break;\\n        }\\n\\n        const chunk = decoder.decode(value, { stream: true });\\n        const lines = chunk.split('\\\\n');\\n        \\n        for (const line of lines) {\\n          if (line.startsWith('data: ')) {\\n            try {\\n              const data = JSON.parse(line.substring(6)) as StreamMessage;\\n              \\n              if (data.type === 'chunk' && data.content) {\\n                accumulatedContent += data.content;\\n                contentEl.innerHTML = this.renderMarkdown(accumulatedContent);\\n                this.scrollToBottom();\\n              } else if (data.type === 'complete') {\\n                // Update conversation ID if provided\\n                if (data.conversation_id) {\\n                  this.currentConversationId = data.conversation_id;\\n                }\\n                // Mark message as complete\\n                messageEl.removeClass('vaultpilot-message-streaming');\\n                break;\\n              } else if (data.type === 'error') {\\n                accumulatedContent += `\\\\n\\\\nError: ${data.error}`;\\n                contentEl.innerHTML = this.renderMarkdown(accumulatedContent);\\n                messageEl.removeClass('vaultpilot-message-streaming');\\n                break;\\n              }\\n            } catch (parseError) {\\n              console.warn('Failed to parse streaming chunk:', parseError);\\n            }\\n          }\\n        }\\n      }\\n      \\n      // Add to messages array\\n      const message: ChatMessage = {\\n        role: 'assistant',\\n        content: accumulatedContent,\\n        timestamp: new Date().toISOString()\\n      };\\n      this.messages.push(message);\\n      \\n    } catch (error) {\\n      console.error('Streaming error:', error);\\n      contentEl.innerHTML = this.renderMarkdown(`Error during streaming: ${error instanceof Error ? error.message : 'Unknown error'}`);\\n    } finally {\\n      reader.releaseLock();\\n      messageEl.removeClass('vaultpilot-message-streaming');\\n    }\\n  }\\n\\n  private getSelectedAgent(): string | undefined {\\n    const selectEl = this.contentEl.querySelector('.vaultpilot-agent-select') as HTMLSelectElement;\\n    return selectEl?.value || undefined;\\n  }\\n\\n  private addMessage(role: 'user' | 'assistant', content: string) {\\n    const message: ChatMessage = {\\n      role,\\n      content,\\n      timestamp: new Date().toISOString()\\n    };\\n\\n    this.messages.push(message);\\n    this.renderMessage(message);\\n    this.scrollToBottom();\\n  }\\n\\n  private renderMessages() {\\n    this.messagesEl.empty();\\n    this.messages.forEach(message => this.renderMessage(message));\\n    this.scrollToBottom();\\n  }\\n\\n  private renderMessage(message: ChatMessage) {\\n    const messageEl = this.messagesEl.createEl('div', {\\n      cls: `vaultpilot-message vaultpilot-message-${message.role}`\\n    });\\n\\n    const roleEl = messageEl.createEl('div', {\\n      cls: 'vaultpilot-message-role',\\n      text: message.role === 'user' ? 'You' : 'VaultPilot'\\n    });\\n\\n    const contentEl = messageEl.createEl('div', {\\n      cls: 'vaultpilot-message-content'\\n    });\\n\\n    // Simple markdown rendering for basic formatting\\n    contentEl.innerHTML = this.renderMarkdown(message.content);\\n\\n    if (message.timestamp) {\\n      const timeEl = messageEl.createEl('div', {\\n        cls: 'vaultpilot-message-time',\\n        text: new Date(message.timestamp).toLocaleTimeString()\\n      });\\n    }\\n  }\\n\\n  private renderMarkdown(text: string): string {\\n    return text\\n      .replace(/\\\\*\\\\*(.*?)\\\\*\\\\*/g, '<strong>$1</strong>')\\n      .replace(/\\\\*(.*?)\\\\*/g, '<em>$1</em>')\\n      .replace(/`(.*?)`/g, '<code>$1</code>')\\n      .replace(/\\\\n/g, '<br>');\\n  }\\n\\n  private scrollToBottom() {\\n    this.messagesEl.scrollTop = this.messagesEl.scrollHeight;\\n  }\\n\\n  private clearChat() {\\n    this.messages = [];\\n    this.currentConversationId = null;\\n    this.messagesEl.empty();\\n    new Notice('Chat cleared');\\n  }\\n\\n  private addStyles() {\\n    if (!document.getElementById('vaultpilot-chat-styles')) {\\n      const styleEl = document.createElement('style');\\n      styleEl.id = 'vaultpilot-chat-styles';\\n      styleEl.textContent = `\\n        .vaultpilot-chat-modal {\\n          width: 600px;\\n          height: 700px;\\n        }\\n        .vaultpilot-chat-header {\\n          display: flex;\\n          justify-content: space-between;\\n          align-items: center;\\n          margin-bottom: 15px;\\n          padding-bottom: 10px;\\n          border-bottom: 1px solid var(--background-modifier-border);\\n        }\\n        .vaultpilot-chat-toolbar {\\n          display: flex;\\n          gap: 10px;\\n          align-items: center;\\n          flex-wrap: wrap;\\n        }\\n        .vaultpilot-auto-mode-info {\\n          margin-right: 15px;\\n          padding: 8px 12px;\\n          border: 1px solid var(--background-modifier-border);\\n          border-radius: 6px;\\n          background: var(--background-secondary);\\n          font-size: 0.85em;\\n          color: var(--text-muted);\\n          display: flex;\\n          align-items: center;\\n          gap: 6px;\\n        }\\n        .vaultpilot-agent-select {\\n          padding: 4px 8px;\\n          border: 1px solid var(--background-modifier-border);\\n          border-radius: 4px;\\n          background: var(--background-primary);\\n          color: var(--text-normal);\\n        }\\n        .vaultpilot-chat-container {\\n          display: flex;\\n          flex-direction: column;\\n          height: calc(100% - 80px);\\n        }\\n        .vaultpilot-chat-messages {\\n          flex: 1;\\n          overflow-y: auto;\\n          padding: 10px;\\n          border: 1px solid var(--background-modifier-border);\\n          border-radius: 8px;\\n          margin-bottom: 15px;\\n          background: var(--background-secondary);\\n        }\\n        .vaultpilot-message {\\n          margin-bottom: 15px;\\n          padding: 10px;\\n          border-radius: 8px;\\n        }\\n        .vaultpilot-message-user {\\n          background: var(--background-primary-alt);\\n          margin-left: 20px;\\n        }\\n        .vaultpilot-message-assistant {\\n          background: var(--background-primary);\\n          margin-right: 20px;\\n        }\\n        .vaultpilot-message-role {\\n          font-weight: bold;\\n          margin-bottom: 5px;\\n          color: var(--text-accent);\\n        }\\n        .vaultpilot-message-content {\\n          line-height: 1.4;\\n          color: var(--text-normal);\\n          user-select: text;\\n        }\\n        .vaultpilot-message-time {\\n          font-size: 0.8em;\\n          color: var(--text-muted);\\n          margin-top: 5px;\\n        }\\n        .vaultpilot-message-streaming {\\n          border-left: 3px solid var(--color-accent);\\n          animation: pulse 2s infinite;\\n        }\\n        .vaultpilot-typing-indicator {\\n          color: var(--text-muted);\\n          font-style: italic;\\n          animation: pulse 1.5s infinite;\\n        }\\n        @keyframes pulse {\\n          0% { opacity: 1; }\\n          50% { opacity: 0.5; }\\n          100% { opacity: 1; }\\n        }\\n        .vaultpilot-chat-input-container {\\n          display: flex;\\n          gap: 10px;\\n        }\\n        .vaultpilot-chat-input {\\n          flex: 1;\\n          padding: 10px;\\n          border: 1px solid var(--background-modifier-border);\\n          border-radius: 6px;\\n          background: var(--background-primary);\\n          color: var(--text-normal);\\n        }\\n        .vaultpilot-send-button {\\n          padding: 10px 20px;\\n        }\\n        .vaultpilot-intent-debug {\\n          background: var(--background-modifier-success);\\n          color: var(--text-normal);\\n          padding: 8px 12px;\\n          border-radius: 4px;\\n          margin: 8px 0;\\n          font-size: 0.85em;\\n          text-align: center;\\n          border: 1px solid var(--background-modifier-border-hover);\\n          animation: fadeInOut 3s ease-in-out;\\n        }\\n        @keyframes fadeInOut {\\n          0% { opacity: 0; transform: translateY(-10px); }\\n          10% { opacity: 1; transform: translateY(0); }\\n          90% { opacity: 1; transform: translateY(0); }\\n          100% { opacity: 0; transform: translateY(-10px); }\\n        }\\n      `;\\n      document.head.appendChild(styleEl);\\n    }\\n  }\\n\\n  private showIntentDebug(intent: string) {\\n    // Create a subtle notification showing the detected intent\\n    const debugEl = this.messagesEl.createEl('div', {\\n      cls: 'vaultpilot-intent-debug',\\n      text: `üîç Intent detected: ${intent === 'agent' ? '‚öôÔ∏è Agent Mode' : 'üí¨ Ask Mode'}`\\n    });\\n    \\n    // Auto-remove after 3 seconds\\n    setTimeout(() => {\\n      debugEl.remove();\\n    }, 3000);\\n  }\\n\\n  // Add a method to show context details\\n  private async showContextDetails() {\\n    try {\\n      const context = await this.contextService.getFullContext();\\n      const summary = await this.contextService.getContextSummary();\\n      \\n      // Create a modal or notice with context details\\n      const contextModal = new Modal(this.app);\\n      contextModal.titleEl.setText('Development Context Details');\\n      \\n      const { contentEl } = contextModal;\\n      contentEl.empty();\\n      contentEl.addClass('vaultpilot-context-details');\\n      \\n      // Add context summary\\n      const summaryEl = contentEl.createEl('div', { cls: 'context-summary' });\\n      summaryEl.createEl('pre', { text: summary });\\n      \\n      // Add detailed context (collapsed by default)\\n      const detailsEl = contentEl.createEl('details');\\n      detailsEl.createEl('summary', { text: 'Full Context Data (JSON)' });\\n      const jsonEl = detailsEl.createEl('pre', { cls: 'context-json' });\\n      jsonEl.textContent = JSON.stringify(context, null, 2);\\n      \\n      contextModal.open();\\n    } catch (error) {\\n      const errorMsg = error instanceof Error ? error.message : 'Unknown error';\\n      new Notice(`Error loading context: ${errorMsg}`);\\n    }\\n  }\\n\\n  onClose() {\\n    const { contentEl } = this;\\n    contentEl.empty();\\n  }\\n}\\n\"]}"}
